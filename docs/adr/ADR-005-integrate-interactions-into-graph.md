# ADR-005: 在圖結構中整合使用者互動邊以支援路徑解釋

## 狀態
已接受 (Accepted)

## 背景 (Context)
在早期的圖建構設計中，Adjacency Matrix 只包含了「物品 <-> 知識圖譜實體」的邊。這導致在執行推薦解釋 (Explanation) 時，使用者節點在圖中是孤立的（僅有自環 Self-loop）。雖然模型能透過 Embedding 計算分數，但解釋器 (Explainer) 無法找出從「使用者」出發，經過何種路徑到達「被推薦物品」的邏輯。

## 決策 (Decision)
1.  **擴充鄰接矩陣**: 在 `construct_adj` 與 `get_adj_indices` 函數中，除了 KG 三元組，額外加入 `interactions` 中的使用者-物品邊。
2.  **節點全局映射**: 修改節點 ID 偏移規則：
    *   `Users`: 0 ~ N-1
    *   `Items`: N ~ N+M-1
    *   `Entities`: N+M ~ End
3.  **雙向邊實作**: 對於每一筆互動 `(u, i)`，在圖中建立 `(u, i+N)` 與 `(i+N, u)` 兩條對應的邊。
4.  **解釋器適配**: 更新解釋器的路徑提取邏輯，使其能夠遍歷「使用者到物品」的協同過濾路徑。

## 後續影響 (Consequences)
*   **優點**:
    *   **可解釋性大幅提升**: 現在可以查出類似 `User -> (Interaction) -> Item A -> (Relation) -> Entity -> (Relation) -> Target Item` 的解釋路徑。
    *   **模型效能改善**: GNN 現在可以整合使用者端的消息傳遞，理論上能捕捉到更高階的協同過濾特徵。
*   **缺點**:
    *   **記憶體開銷增加**: 鄰接矩陣中的非零元素 (Edges) 數量增加，訓練時需注意 GPU 記憶體監控。
    *   **必須重新訓練**: 由於模型輸入的圖結構發生改變，舊的 Checkpoint 權重雖然能讀取，但無法發揮最佳效果。
